<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Car Tools ‚Äì EV Efficiency & VED Bands</title>
  <style>
    :root {
      --transition-speed: 0.2s;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 32px 16px;
      box-sizing: border-box;
      transition: background var(--transition-speed) ease, color var(--transition-speed) ease;
      color: var(--text-color);
    }

    /* üåô Dark mode theme */
    body[data-theme="dark"] {
      background: radial-gradient(circle at top, #1f2937, #020617 60%);
      --text-color: #f9fafb;
      --card-bg: #020617;
      --border-color: #1f2937;
      --muted-text: #d1d5db;
      --input-bg: #020617;
      --input-border: #334155;
      --link-color: #93c5fd;
      --result-info-bg: #0b1120;
      --result-info-text: #e5e7eb;
      --button-bg: linear-gradient(135deg, #2563eb, #22c55e);
      --chip-bg: #020617;
      --chip-border: #475569;
    }

    /* ‚òÄÔ∏è Light mode theme */
    body[data-theme="light"] {
      background: #f3f4f6;
      --text-color: #111827;
      --card-bg: #ffffff;
      --border-color: #e5e7eb;
      --muted-text: #6b7280;
      --input-bg: #f9fafb;
      --input-border: #d1d5db;
      --link-color: #2563eb;
      --result-info-bg: #eff6ff;
      --result-info-text: #1e3a8a;
      --button-bg: linear-gradient(135deg, #2563eb, #22c55e);
      --chip-bg: #ffffff;
      --chip-border: #d1d5db;
    }

    .container {
      width: 100%;
      max-width: 720px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .header-text h1 {
      margin: 0 0 4px;
      font-size: 1.7rem;
      color: var(--text-color);
    }

    .header-text p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--muted-text);
    }

    .theme-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      color: var(--text-color);
      font-size: 0.8rem;
      cursor: pointer;
      user-select: none;
    }

    .theme-toggle span {
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .switcher {
      display: flex;
      justify-content: center;
      margin: 20px auto 18px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .switch-btn {
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      color: var(--text-color);
      font-size: 0.9rem;
      cursor: pointer;
      transition: background var(--transition-speed) ease, color var(--transition-speed) ease;
    }

    .switch-btn.active {
      background: var(--button-bg);
      color: #ffffff;
      border-color: transparent;
      font-weight: 600;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 22px 24px;
      box-shadow: 0 20px 45px rgba(0,0,0,0.18);
      border: 1px solid var(--border-color);
    }

    .tool {
      display: none;
    }

    .tool.active {
      display: block;
    }

    h2 {
      margin-top: 0;
      font-size: 1.3rem;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    input, select {
      width: 100%;
      padding: 9px 11px;
      border-radius: 10px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-color);
      font-size: 0.95rem;
      box-sizing: border-box;
      margin-bottom: 12px;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px #3b82f6;
    }

    button.primary {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      background: var(--button-bg);
      color: #ffffff;
      margin-top: 4px;
    }

    .result {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: 10px;
      display: none;
      background: var(--result-info-bg);
      color: var(--result-info-text);
    }

    .hint, .note {
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--muted-text);
      line-height: 1.4;
    }

    .section-divider {
      margin: 16px 0 10px;
      border-top: 1px solid var(--border-color);
      padding-top: 10px;
      font-size: 0.85rem;
      color: var(--muted-text);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    a {
      color: var(--link-color);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body data-theme="dark">
  <div class="container">
    <div class="header">
      <div class="header-text">
        <h1>Car Tools</h1>
        <p>EV efficiency converters & UK VED lookup</p>
      </div>
      <button class="theme-toggle" id="theme-toggle" type="button">
        <span id="theme-icon">üåô</span>
        <span id="theme-label">Dark</span>
      </button>
    </div>

    <div class="switcher">
      <button class="switch-btn active" data-target="tool-evmpg">EV Efficiency Tools</button>
      <button class="switch-btn" data-target="tool-tax">Car Tax Band Lookup</button>
    </div>

    <div class="card">
      <!-- EV tools tab -->
      <div id="tool-evmpg" class="tool active">
        <h2>EV Efficiency Tools</h2>

        <!-- Estimate first -->
        <div class="section-divider">Estimate mi/kWh from range</div>
        <input id="ev-pack" type="number" min="0" step="0.1" placeholder="Usable battery (kWh)" />
        <input id="ev-soc" type="number" min="0" max="100" placeholder="Battery % for that range" />
        <input id="ev-range" type="number" min="0" placeholder="Displayed range (miles)" />
        <button class="primary" id="ev-estimate-btn">Estimate efficiency</button>
        <div id="ev-est-result" class="result">
          <div id="ev-est-text"></div>
        </div>

        <!-- mpg-e second -->
        <div class="section-divider">Miles per kWh ‚Üí mpg equivalent</div>
        <input id="ev-mpkwh" type="number" min="0" step="0.1" placeholder="Efficiency (mi/kWh)" />
        <input id="ev-price" type="number" min="0" step="0.1" placeholder="Electricity price (p/kWh, optional)" />
        <button class="primary" id="ev-calc-btn">Calculate</button>
        <div id="ev-result" class="result">
          <div id="ev-lines"></div>
          <div id="ev-cost-line" class="hint"></div>
        </div>

        <p class="note">
          Uses approximate energy content: ~9.5 kWh/L petrol, ~10.7 kWh/L diesel, 4.546 L per UK gallon.
          Results are for comparison only, not official WLTP or VED data.
        </p>
      </div>

      <!-- Tax tools tab -->
      <div id="tool-tax" class="tool">
        <h2>Car Tax Band Lookup (UK)</h2>
        <label for="reg-period">Registration period</label>
        <select id="reg-period">
          <option value="2001-2017">1 Mar 2001 ‚Äì 31 Mar 2017 (A‚ÄìM bands)</option>
          <option value="2017plus">On or after 1 Apr 2017 (modern system)</option>
        </select>

        <label for="co2">CO‚ÇÇ emissions (g/km)</label>
        <input id="co2" type="number" min="0" placeholder="e.g. 119" />

        <button class="primary" id="lookup-btn">Look up tax band</button>

        <div id="tax-result" class="result">
          <div id="tax-main"></div>
          <div id="tax-extra" class="hint"></div>
        </div>

        <p class="note">
          Quick CO‚ÇÇ-based view only. For full, up-to-date VED rates and the expensive-car supplement,
          see <a href="https://www.gov.uk/vehicle-tax-rate-tables" target="_blank" rel="noreferrer">gov.uk</a>.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Theme toggle
    const body = document.body;
    const themeToggle = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");
    const themeLabel = document.getElementById("theme-label");

    function setTheme(theme) {
      body.setAttribute("data-theme", theme);
      if (theme === "light") {
        themeIcon.textContent = "‚òÄÔ∏è";
        themeLabel.textContent = "Light";
      } else {
        themeIcon.textContent = "üåô";
        themeLabel.textContent = "Dark";
      }
      try {
        localStorage.setItem("car-tools-theme", theme);
      } catch (e) {}
    }

    (function initTheme() {
      let stored = "dark";
      try {
        const saved = localStorage.getItem("car-tools-theme");
        if (saved === "light" || saved === "dark") stored = saved;
      } catch (e) {}
      setTheme(stored);
    })();

    themeToggle.addEventListener("click", () => {
      const current = body.getAttribute("data-theme") || "dark";
      const next = current === "dark" ? "light" : "dark";
      setTheme(next);
    });

    // Tab switcher
    const switchButtons = document.querySelectorAll(".switch-btn");
    const tools = document.querySelectorAll(".tool");

    switchButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const targetId = btn.getAttribute("data-target");

        switchButtons.forEach(b => b.classList.remove("active"));
        tools.forEach(t => t.classList.remove("active"));

        btn.classList.add("active");
        document.getElementById(targetId).classList.add("active");
      });
    });

    // EV: estimate mi/kWh from range
    const evPackInput = document.getElementById("ev-pack");
    const evSocInput = document.getElementById("ev-soc");
    const evRangeInput = document.getElementById("ev-range");
    const evEstimateBtn = document.getElementById("ev-estimate-btn");
    const evEstResult = document.getElementById("ev-est-result");
    const evEstText = document.getElementById("ev-est-text");

    function estimateFromRange() {
      const pack = parseFloat(evPackInput.value);
      const soc = parseFloat(evSocInput.value);
      const range = parseFloat(evRangeInput.value);

      evEstResult.style.display = "block";

      if (!pack || !soc || !range || soc <= 0 || soc > 100) {
        evEstText.textContent = "Enter battery kWh, battery % (1‚Äì100), and range in miles.";
        return;
      }

      const usableKwh = pack * (soc / 100);
      const mpkwh = range / usableKwh;

      evEstText.textContent =
        `‚âà ${mpkwh.toFixed(2)} mi/kWh based on ${range.toFixed(0)} mi at ` +
        `${soc.toFixed(0)}% of a ${pack.toFixed(1)} kWh usable battery.`;
    }

    evEstimateBtn.addEventListener("click", estimateFromRange);

    // EV: mi/kWh ‚Üí mpg equivalent
    const LITRES_PER_UK_GALLON = 4.54609;
    const KWH_PER_LITRE_PETROL = 9.5;
    const KWH_PER_LITRE_DIESEL = 10.7;

    const evMpkwhInput = document.getElementById("ev-mpkwh");
    const evPriceInput = document.getElementById("ev-price");
    const evCalcBtn = document.getElementById("ev-calc-btn");
    const evResult = document.getElementById("ev-result");
    const evLines = document.getElementById("ev-lines");
    const evCostLine = document.getElementById("ev-cost-line");

    function calculateEvMpg() {
      const eff = parseFloat(evMpkwhInput.value);
      const price = parseFloat(evPriceInput.value);

      evResult.style.display = "block";

      if (!eff || eff <= 0) {
        evLines.textContent = "Enter a valid mi/kWh value.";
        evCostLine.textContent = "";
        return;
      }

      const mpgPetrol = eff * KWH_PER_LITRE_PETROL * LITRES_PER_UK_GALLON;
      const mpgDiesel = eff * KWH_PER_LITRE_DIESEL * LITRES_PER_UK_GALLON;

      evLines.innerHTML =
        `${eff.toFixed(2)} mi/kWh ‚âà ${mpgPetrol.toFixed(1)} mpg (petrol) | ` +
        `${mpgDiesel.toFixed(1)} mpg (diesel)`;

      if (!isNaN(price) && price > 0) {
        const pencePerMile = price / eff;
        evCostLine.textContent =
          `‚âà ${pencePerMile.toFixed(1)} p/mile at ${price.toFixed(1)} p/kWh.`;
      } else {
        evCostLine.textContent = "";
      }
    }

    evCalcBtn.addEventListener("click", calculateEvMpg);

    // Tax lookup
    const taxMain = document.getElementById("tax-main");
    const taxExtra = document.getElementById("tax-extra");
    const taxResult = document.getElementById("tax-result");
    const lookupBtn = document.getElementById("lookup-btn");

    function lookupTaxBand() {
      const co2 = parseFloat(document.getElementById("co2").value);
      const period = document.getElementById("reg-period").value;

      if (!co2 || co2 < 0) {
        taxResult.style.display = "block";
        taxMain.textContent = "Enter a valid CO‚ÇÇ value.";
        taxExtra.textContent = "";
        return;
      }

      taxResult.style.display = "block";

      if (period === "2001-2017") {
        let band = "M";
        let rangeLabel = "Over 255 g/km";
        const bands = [
          [100, "A"],
          [110, "B"],
          [120, "C"],
          [130, "D"],
          [140, "E"],
          [150, "F"],
          [165, "G"],
          [175, "H"],
          [185, "I"],
          [200, "J"],
          [225, "K"],
          [255, "L"]
        ];
        for (const [max, b] of bands) {
          if (co2 <= max) {
            band = b;
            rangeLabel = `Up to ${max} g/km`;
            break;
          }
        }
        taxMain.textContent = `CO‚ÇÇ ${co2.toFixed(0)} g/km ‚Üí Band ${band} (${rangeLabel})`;
        taxExtra.textContent =
          "For cars first registered between 1 March 2001 and 31 March 2017 (bands A‚ÄìM).";
      } else {
        let label;
        if (co2 === 0) label = "Zero emission";
        else if (co2 <= 50) label = "Ultra-low";
        else if (co2 <= 100) label = "Low";
        else if (co2 <= 150) label = "Medium";
        else if (co2 <= 225) label = "High";
        else label = "Very high";

        taxMain.textContent =
          `CO‚ÇÇ ${co2.toFixed(0)} g/km ‚Üí ${label} first-year CO‚ÇÇ range.`;
        taxExtra.textContent =
          "For cars from 1 April 2017: first year is CO‚ÇÇ-based, then a flat standard rate plus any expensive-car supplement.";
      }
    }

    lookupBtn.addEventListener("click", lookupTaxBand);
  </script>
</body>
</html>
